<div *ngIf="activeProduct" class="build-viewer text-center">    
    <div class="container">
        <h2 class="mt-3 text-left">{{activeProduct?.name}}</h2>
        <div class="text-right"><button type="button text-right" class="btn-green ml-3 my-1 mr-1" (click)="openBuildModel(true)">Run New Build</button></div>
        <div class="text-left error" *ngIf="errorMsg">{{errorMsg}}</div>
        <div class="panel-top mb-3">
            <a class="position-absolute link-back" routerLink="/{{releaseCenterKey}}">
                <span class="font-weight-bold">&lt;&lt;&nbsp;</span> Back To Release Center
            </a>            
            <div class="panel-header text-left pl-2 pt-3"><span class="font-weight-bold">{{buildLoading ? 'Loading...' : activeBuild.id}}</span></div>
            <div>
                <div class="row mx-0">
                    <div class="col-6 text-left">
                        <div class="form-group mx-sm-3 mb-2 mt-2">
                            <label class="w-25 font-weight-bold">Effective Time:</label>
                            <span class="font-weight-bold">{{buildLoading ? '' : activeBuild.configuration?.effectiveTime}}</span>
                        </div>
                        <div class="form-group mx-sm-3 mb-2 mt-2">
                            <label class="w-25 font-weight-bold">Export Type:</label>
                            <span class="font-weight-bold">{{buildLoading ? '' : activeBuild.configuration?.exportType}}</span>
                        </div>
                        <div class="form-group mx-sm-3 mb-2 mt-2">
                            <label class="w-25 font-weight-bold">Branch:</label>
                            <span class="font-weight-bold">{{buildLoading ? '' : activeBuild.configuration?.branchPath}}</span>
                        </div>
                        <div class="form-group mx-sm-3 mb-2 mt-2">
                            <label class="w-25 font-weight-bold">Failure Max:</label>
                            <span class="font-weight-bold">{{buildLoading ? '' : activeBuild.qaTestConfig?.maxFailureExport}}</span>
                        </div>
                    </div>
                    <div class="col-6 text-left">
                        <div class="form-group mx-sm-3 mb-2 mt-2">
                            <label class="w-25 font-weight-bold">Status:</label>
                            <span class="font-weight-bold">{{buildLoading ? '' : activeBuild.status}}</span>
                        </div>
                        <div class="form-group mx-sm-3 mb-2 mt-2 mb-5">
                            <label class="w-25 font-weight-bold"></label>
                            <button type="button" class="btn-blue" [disabled]="!activeBuild.id || activeBuild.status !== 'BUILDING' || buildLoading">View Process</button>
                            <button type="button" class="btn-mandy ml-3" [disabled]="!activeBuild.id || activeBuild.status !== 'BUILDING' || buildLoading" (click)="stopBuild(activeBuild)">Stop Build</button>
                        </div>                        
                        <div class="form-group mx-sm-3 mb-2 mt-2 mb-3">
                            <label class="w-25 font-weight-bold">Result:</label>                            
                            <button type="button" class="btn-green" 
                                    [disabled]="!activeBuild.id || buildLoading || activeBuild.publishingBuild || activeBuild.status!== 'BUILT' ||  activeBuild.tag === 'PUBLISHED'" 
                                    (click)="publishBuild(activeBuild)">{{activeBuild.publishingBuild ? 'Publishing...' : 'Publish Build'}}</button>
                            <button type="button" class="btn-mandy ml-3" [disabled]="!activeBuild.id || buildLoading">Delete Build</button>
                        </div>
                    </div>
                </div>                
            </div>    
            <div class="panel-footer text-right">
                <button type="button" class="btn-blue" [disabled]="!activeBuild.id || buildLoading || activeBuild.downloadingBuildPackage" (click)="downloadBuildPackage(activeBuild)">{{activeBuild.downloadingBuildPackage ? 'Downloading...' : 'Download'}}</button>
                <button type="button" class="btn-sea-buckthorn ml-3 my-1" [disabled]="!activeBuild.id || buildLoading">View Log</button>
                <button type="button" class="btn-blue ml-3 my-1" (click)="viewAll()">View All</button>
                <button type="button" class="btn-green ml-3 my-1 mr-1" [disabled]="!activeBuild.id || buildLoading" (click)="openBuildModel()">Re-Run</button>
            </div>
        </div>    
        <table class="table table-bordered">
            <tr>
                <th>Build Date</th>
                <th>Status</th>
                <th>User</th>
                <th>Log</th>
                <th>Release</th>
                <th>Tag</th>
            </tr>
            <tr *ngFor="let build of builds | paginate: {id: 'builds_table', itemsPerPage: 10, currentPage: p, totalItems: builds?.length}" (click)="setActiveBuild(build)" [class.active]="activeBuild.id === build.id">
                <td>{{build?.id}}</td>
                <td>{{build?.status}}</td>
                <td>{{build?.buildUser}}</td>
                <td class="btn-download"><button type="button" class="btn-blue" [class.downloading]="build.downloadingBuildLog" [disabled]="build.downloadingBuildLog" (click)="downloadBuildLog(build); $event.stopPropagation()">{{build.downloadingBuildLog ? 'Downloading...' : 'Download'}}</button></td>
                <td class="btn-download"><button type="button" class="btn-blue" [class.downloading]="build.downloadingBuildPackage" [disabled]="build.downloadingBuildPackage" (click)="downloadBuildPackage(build); $event.stopPropagation()">{{build.downloadingBuildPackage ? 'Downloading...' : 'Download'}}</button></td>
                <td>{{build?.tag}}</td>
            </tr>
        </table>
        <pagination-controls id="builds_table"
                      (pageChange)="p = $event"
                      maxSize="100"
                      directionLinks="true"
                      autoHide="true"
                      responsive="true"
                      previousLabel="Previous"
                      nextLabel="Next">
        </pagination-controls>
    </div>
</div>

<!-- BUILD MODAL -->
<app-modal id="build-modal" class="modal build-modal">
    <h3 header class="mb-0">Build Configurations</h3>
    <div body class="text-center p-5">
        <p>Please enter the details for the Build</p>        
        <input [disabled]="buildTriggering" type="text" placeholder="Effective Time"class="w-75 rounded-lg p-3 m-3" bsDatepicker [(bsValue)]="buildParams.effectiveDate" value="{{ buildParams.effectiveDate | date:'yyyy-MM-dd' }}">
        <select [disabled]="buildTriggering" class="w-75 rounded-lg p-3 m-3" [(ngModel)]="buildParams.exportType">
            <option value="PUBLISHED">Published</option>
            <option value="UNPUBLISHED">Unpublished</option>
            <option value="FEEDBACK_FIX">Feedback Fix</option>            
        </select>
        <input [disabled]="buildTriggering" class="w-75 rounded-lg p-3 m-3" type="text" [(ngModel)]="buildParams.branch" placeholder="Branch">        
        <input [disabled]="buildTriggering" class="w-75 rounded-lg p-3 m-3" type="text" [(ngModel)]="buildParams.maxFailureExport" placeholder="Failure Max">
    </div>

    <div footer>
        <button type="button" class="btn-sea-buckthorn" [disabled]="buildTriggering" (click)="closeModal('build-modal')">Cancel</button>
        <button type="button" class="btn-blue" [disabled]="buildTriggering" (click)="runBuild()">Run</button>
    </div>
</app-modal>